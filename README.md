# LevelZero-Trace-Analyzer
Analyze a level zero trace file generated by THAPI[https://github.com/argonne-lcf/THAPI] and detect issues that could cause an event timeout such as:
* An event (or an event in its dependency chain) was reset prior to `zeEventHostSynchronize`
* An event (or an event in its dependency chain) was not signaled
* An event (or an event in its dependency chain) depends on a another event in the same dependency chain resulting in a circular dependency


## Usage

### Install THAPI
Easiest way to do is this via spack:
```
git clone -c feature.manyFiles=true https://github.com/spack/spack.git
cd spack/
git checkout releases/latest
. share/spack/setup-env.sh
git clone https://github.com/argonne-lcf/THAPI-spack
spack repo add ./THAPI-spack/
spack install thapi@master
spack find
spack find --loaded
spack load thapi
```

### Generate a Trace:
```
iprof -m full ./app.bin
# Generates a raw trace
iprof -t -r ~/lttng-traces/iprof-20230626-153925 > app.trace
```

### Analyze an Event
If your Level Zero application apears to hang it possible it's hanging on a `zeEventHostSynchronize()` call due to one of the issues described above. You can cancel the `iprof` execution and it will still generate a trace file which you can then edit/view and find the zeEventHostSyncrhonize() entry line that doesn't have an exit similar to this:

```
08:18:04.12 - cupcake - vpid: 267004, vtid: 267004 - lttng_ust_ze:zeEventHostSynchronize_entry: { hEvent: 0x0000556c1d005780, timeout: 18446744073709551615 }
```

And finally analzye the trace file for this pointer:
```
python ./eventTraceAnalysis.py "0x0000556c1d005780" ./app.trace
```


